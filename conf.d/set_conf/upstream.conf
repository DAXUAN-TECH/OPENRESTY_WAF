# 后端服务器配置
# 注意：此文件保持在项目目录，不复制到系统目录

# 示例：后端服务器配置（高并发优化）
upstream backend {
    # 后端服务器地址（支持多个，实现负载均衡）
    server 127.0.0.1:8080 max_fails=3 fail_timeout=30s weight=1;
    # server 127.0.0.1:8081 max_fails=3 fail_timeout=30s weight=1;  # 如果有多个后端
    
    # Keepalive 连接池（高并发场景下非常重要）
    # 每个 worker 进程保持的 keepalive 连接数
    # 建议值：worker_connections 的 10-20%
    keepalive 1024;  # 从 32 增加到 1024，支持更多并发连接
    
    # Keepalive 请求数（每个连接最多处理多少个请求）
    keepalive_requests 10000;
    
    # Keepalive 超时时间
    keepalive_timeout 60s;
    
    # 负载均衡算法（可选）
    # least_conn;  # 最少连接数
    # ip_hash;    # IP 哈希（会话保持）
    # fair;       # 响应时间（需要第三方模块）
}

