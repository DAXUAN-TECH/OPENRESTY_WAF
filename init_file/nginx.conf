# OpenResty WAF 主配置文件
# 注意：此文件会被复制到 /usr/local/openresty/nginx/conf/nginx.conf
# 日志路径指向项目目录的 logs 文件夹（通过部署脚本自动替换）

user  nobody;
worker_processes  auto;

# 错误日志和 PID 文件路径（部署脚本会自动替换为项目目录路径）
# 注意：这里使用占位符，部署脚本会替换为实际路径
error_log  /path/to/project/logs/error.log warn;
pid        /path/to/project/logs/nginx.pid;

events {
    # 每个 worker 进程的最大连接数
    # 理论最大并发 = worker_processes × worker_connections
    # 例如：8 workers × 65535 = 524,280 并发连接
    worker_connections  65535;
    
    # 使用 epoll 事件模型（Linux 系统，性能最佳）
    use epoll;
    
    # 允许 worker 进程同时接受多个新连接
    multi_accept on;
    
    # 接受连接后，尽可能多地接受新连接
    accept_mutex off;  # 在高并发场景下关闭互斥锁，减少延迟
}

http {
    # 项目根目录（用于 Lua 脚本和日志路径）
    # 部署脚本会自动替换为实际项目路径
    set $project_root "/path/to/project";
    
    # 包含参数配置（指向项目目录的 conf.d）
    # 部署脚本会自动替换为实际项目路径
    include /path/to/project/conf.d/set_conf/*.conf; 
    # 包含服务器配置（指向项目目录的 conf.d）
    include /path/to/project/conf.d/vhost_conf/*.conf;
}
