<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统设置 - WAF管理</title>
    <link rel="stylesheet" href="/css/system_settings.css">
    <script src="/common.js"></script>
    <script src="/js/system_settings.js"></script>
</head>
<body>
    <div class="container">
        <h1>系统设置</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('whitelist')">系统访问白名单</button>
            <button class="tab" onclick="switchTab('admin_ssl')">管理端SSL/域名</button>
        </div>
        
        <div id="alert-container"></div>
        
        <!-- 系统访问白名单 -->
        <div id="whitelist-tab" class="tab-content active">
            <!-- 工具栏 -->
            <div class="toolbar">
                <div class="filters">
                    <select id="filter-status">
                        <option value="">全部状态</option>
                        <option value="1">已启用</option>
                        <option value="0">已禁用</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="applyFilters()">查询</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">重置</button>
                    <button class="btn btn-primary" onclick="showAddModal()">添加IP</button>
                    <button class="btn btn-primary" onclick="loadWhitelist()">刷新</button>
                </div>
            </div>
            
            <!-- 白名单列表 -->
            <table id="whitelist-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>IP地址</th>
                        <th>说明</th>
                        <th>状态</th>
                        <th>创建时间</th>
                        <th>更新时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="whitelist-tbody">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">加载中...</td>
                    </tr>
                </tbody>
            </table>
            
            <!-- 分页 -->
            <div class="pagination" id="whitelist-pagination"></div>
        </div>

        <!-- 管理端 SSL 与域名配置 -->
        <div id="admin-ssl-tab" class="tab-content">
            <div class="form-group">
                <label>启用管理端 HTTPS</label>
                <div style="display:flex;align-items:center;gap:10px;">
                    <input type="checkbox" id="admin-ssl-enable">
                    <span style="font-size:13px;color:#666;">开启后，将在管理端监听 443 端口并加载下方配置的证书</span>
                </div>
            </div>
            <div class="form-group">
                <label>管理端域名</label>
                <input type="text" id="admin-server-name" placeholder="例如：waf-admin.example.com，多域名请用空格分隔">
                <small style="color:#666;font-size:12px;display:block;margin-top:4px;">此域名将用于 Nginx 的 server_name 配置，建议与证书中的域名保持一致。</small>
            </div>
            <div class="form-group">
                <label>SSL证书 (PEM格式)</label>
                <textarea id="admin-ssl-pem" rows="8" placeholder="粘贴管理端HTTPS使用的证书内容（包含 -----BEGIN CERTIFICATE----- / -----END CERTIFICATE-----）"></textarea>
            </div>
            <div class="form-group">
                <label>SSL私钥 (KEY格式)</label>
                <textarea id="admin-ssl-key" rows="8" placeholder="粘贴管理端HTTPS使用的私钥内容（包含 -----BEGIN PRIVATE KEY----- / -----END PRIVATE KEY-----）"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="saveAdminSslConfig()">保存</button>
            </div>
            <small style="color:#666;font-size:12px;display:block;margin-top:10px;">
                提示：保存后系统会自动测试并重新加载 Nginx 配置，如有语法错误将返回详细错误信息，请根据提示修正配置。
            </small>
        </div>
    </div>
    
    <!-- 添加/编辑模态框 -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 id="modal-title">添加IP</h2>
            <form id="edit-form" onsubmit="saveWhitelist(event)">
                <div class="form-group">
                    <label>IP地址 *</label>
                    <textarea id="edit-ip-address" placeholder="192.168.1.1 或 192.168.1.1,192.168.1.2 或 192.168.1.0/24 或 192.168.1.1-192.168.1.100" required style="min-height: 80px;"></textarea>
                    <small style="color: #666; font-size: 12px;">支持单个IP（如：192.168.1.100）、多个IP（逗号分隔，如：192.168.1.1,192.168.1.2,192.168.1.3）或IP段（如：192.168.1.0/24 或 192.168.1.1-192.168.1.100）</small>
                </div>
                <div class="form-group">
                    <label>说明</label>
                    <textarea id="edit-description" placeholder="请输入说明"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    
</body>
</html>

